{% extends "base.html" %}

{% block app_content %}

<h2 id="title" class="display-4 mt-4 col-md-12">Results:</h2>

<div class="container cm-s-netlogo-default">

    {%for p in dictionary.primitives.keys()%}
    <div id="{{p}}" style="display: none;" class="dictionary-entry">
        <div  class="card  
                    {%if 'observer'  in dictionary.primitives[p].agents%} observer  {%endif%}
                    {%if 'turtles'   in dictionary.primitives[p].agents%} turtles   {%endif%}
                    {%if 'patches'   in dictionary.primitives[p].agents%} patches   {%endif%}
                    {%if 'links'     in dictionary.primitives[p].agents%} links     {%endif%}
                    {%if 'utilities' in dictionary.primitives[p].agents%} utilities {%endif%}
                    ">
            <div class="card-body">
                <h5 class="card-title"><a href="/primitive/{{p}}" class="card-link"><code>{{dictionary.primitives[p]['display_name']}}</code></a></h5>
                <p>  
                    <small>
                        {%if 'observer' in dictionary.primitives[p].agents%}
                        <span class="badge badge-light">
                            <i class="fas fa-eye"></i> observer
                        </span>
                        {%endif%}
                        
                        {%if 'turtles' in dictionary.primitives[p].agents%}
                        <span class="badge badge-danger">
                            <i class="fas fa-location-arrow"></i> turtles
                        </span>
                        {%endif%}
                        
                        {%if 'patches' in dictionary.primitives[p].agents%}
                        <span class="badge badge-success">
                            <i class="fas fa-square-full"> </i> patches
                        </span>
                        {%endif%}
                        
                        {%if 'links' in dictionary.primitives[p].agents%}
                        <span class="badge badge-warning">
                            <i class="fas fa-project-diagram"></i> links
                        </span>
                        {%endif%}
                        
                        {%if 'utilities' in dictionary.primitives[p].agents%}
                        <span class="badge badge-secondary">
                            <i class="fas fa-filter"></i> utilities
                        </span>
                        {%endif%}
                    
                    </small>
                </p>
                <p class="card-text">{{dictionary.primitives[p].short_description}}</p>
                <span style="float: right;"><a href="/primitive/{{p}}" class="btn btn-primary ml-md-auto">Read more</a></span>
            </div>
        </div>
        <div class="clearfix">&nbsp;</div>
    </div>
    {%endfor%}
</div>

<script type="text/javascript">

    window.addEventListener('primitivesLoaded', function(){
        const url = window.location.search;
        const urlParams = new URLSearchParams(url);
        const titleTag = $local("#title");
        
        if (urlParams.has("term")){
            const term = urlParams.get("term");
            titleTag.text("Results for: " + term);

            let matches = primitivesBloodhound.search(term, function(datums){
                datums.forEach(function(e){
                    if(e.endsWith("?")){
                        e = e.substring(0, e.length - 1);
                    }
                    $local('#' + e).attr("style", "display: default;");
                });
            });
        } else {
            $local(".dictionary-entry").each(function(i, e){
                e.setAttribute("style", "display: default;");
            })
        }
    })   
    $local(".card-title code").each(function(i, e){
            console.log(e)
            CodeMirror.runMode(e.textContent, "netlogo", e);
        });    
</script>

{% endblock %}